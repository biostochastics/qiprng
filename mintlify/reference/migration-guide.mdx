---
title: 'Migration Guide'
description: 'Upgrade paths and breaking changes between qiprng versions'
sidebarTitle: 'Migration Guide'
---

# Migration Guide

This guide helps you upgrade between major versions of qiprng, highlighting breaking changes and providing migration paths.

## Upgrading to v0.6.0

<Warning>
**Breaking Changes**: v0.6.0 includes significant API changes and performance improvements that may require code updates.
</Warning>

### Major Changes

#### 1. Enhanced Thread Safety

**Old behavior (v0.5.x)**:
```r
# Basic PRNG creation
createPRNG(list(a = 3, b = 7, c = -5))
values <- generatePRNG(1000)
```

**New behavior (v0.6.0)**:
```r
# Thread-safe configuration required for parallel code
createPRNG(list(
  a = 3, b = 7, c = -5,
  use_threading = TRUE,  # Enable thread-local instances
  use_parallel_filling = TRUE  # Parallel buffer generation
))
values <- generatePRNG(1000)
```

#### 2. Seed Parameter Changes

**Old behavior**:
```r
# Seed was optional and didn't affect crypto mixing
createPRNG(list(seed = 12345))
```

**New behavior**:
```r
# Seed now disables crypto mixing for reproducibility
createPRNG(list(
  seed = 12345,
  use_crypto_mixing = FALSE  # Automatically set when seed provided
))
```

#### 3. New Mixing Strategies

**v0.5.x**: Single mixing approach
```r
createPRNG(list(use_crypto_mixing = TRUE))
```

**v0.6.0**: Multiple strategies available
```r
createPRNG(list(
  use_crypto_mixing = TRUE,
  mixing_strategy = "cascade_mix"  # New in v0.6.0
  # Options: "round_robin", "xor_mix", "averaging",
  #          "modular_add", "cascade_mix"
))
```

### Performance Improvements

v0.6.0 includes significant performance enhancements:

- **3x faster** buffer filling with parallel generation
- **50% reduction** in memory usage for large buffers
- **Zero-copy** operations in critical paths

### Bug Fixes

- Fixed thread safety issues in global instance
- Resolved memory leaks in long-running processes
- Corrected overflow conditions in jump-ahead algorithms

### Deprecated Features

<Note>
These features are deprecated and will be removed in v0.7.0
</Note>

```r
# DEPRECATED: Old caching functions
cache_discriminants()  # Use import_cached_results()
get_cache_status()     # Use cache_status()

# DEPRECATED: Legacy distribution parameters
createPRNG(list(
  dist_type = "normal"  # Use 'distribution' instead
))
```

## Upgrading to v0.5.0

### New Features

#### Caching Framework

v0.5.0 introduced the caching framework for discriminant analysis:

```r
# New caching functions
results <- cached_comprehensive_comparison(
  sample_size = 10000,
  discriminants = 5,
  distributions = c("uniform", "normal"),
  tests = c("ks", "runs", "autocorrelation")
)

# Import/export cached results
export_cached_results("analysis.rds")
import_cached_results("analysis.rds")
```

#### Enhanced Jump-Ahead

New jump-ahead algorithms with better overflow protection:

```r
# v0.4.x - Limited to small jumps
jumpAheadPRNG(1000)

# v0.5.0 - Supports astronomical jumps
jumpAheadPRNG(1e15, algorithm = "mpfr_matrix")
```

### API Changes

#### Configuration Structure

**v0.4.x**:
```r
config <- list(
  qi_a = 3,
  qi_b = 7,
  qi_c = -5
)
```

**v0.5.0**:
```r
config <- list(
  a = 3L,  # Note: integers preferred
  b = 7L,
  c = -5L
)
```

## Upgrading from v0.3.x or Earlier

### Complete API Overhaul

<Warning>
**Major Rewrite**: v0.4.0 was a complete rewrite. Direct migration may not be possible.
</Warning>

#### Old API (v0.3.x)

```r
# Old initialization
prng <- qiprng.new(3, 7, -5)
values <- qiprng.generate(prng, 1000)
qiprng.cleanup(prng)
```

#### New API (v0.4.0+)

```r
# New initialization
createPRNG(list(a = 3, b = 7, c = -5))
values <- generatePRNG(1000)
cleanup_prng()  # Global cleanup
```

### Feature Mapping

| v0.3.x Feature | v0.4.0+ Equivalent | Notes |
|----------------|-------------------|--------|
| `qiprng.new()` | `createPRNG()` | Global instance model |
| `qiprng.generate()` | `generatePRNG()` | Simplified API |
| `qiprng.set_dist()` | Configuration parameter | Set in `createPRNG()` |
| `qiprng.reseed()` | `reseedPRNG()` | Enhanced security |
| Manual threading | `use_threading = TRUE` | Automatic management |

## Common Migration Patterns

### Pattern 1: Basic Usage

**Before**:
```r
# Any version before v0.6.0
source("qiprng.R")
prng <- initialize_generator(params)
random_numbers <- generate(prng, count)
```

**After (v0.6.0)**:
```r
library(qiprng)
createPRNG(default_config)
random_numbers <- generatePRNG(count)
```

### Pattern 2: Parallel Generation

**Before**:
```r
# Manual parallel setup
library(parallel)
cl <- makeCluster(4)
clusterEvalQ(cl, {
  library(qiprng)
  createPRNG()
})
results <- parLapply(cl, 1:4, function(x) generatePRNG(1000))
```

**After**:
```r
# Automatic parallel support
createPRNG(list(use_threading = TRUE))
results <- parallel::mclapply(1:4, function(x) generatePRNG(1000))
```

### Pattern 3: Distribution Generation

**Before**:
```r
# Separate transformation step
uniform_values <- generatePRNG(1000)
normal_values <- qnorm(uniform_values, mean = 10, sd = 2)
```

**After**:
```r
# Direct distribution generation
createPRNG(list(
  distribution = "normal",
  normal_mean = 10,
  normal_sd = 2
))
normal_values <- generatePRNG(1000)
```

## Testing Your Migration

### Verification Script

Use this script to verify your migration:

```r
# Test migration completeness
test_migration <- function() {
  # Test 1: Basic generation
  createPRNG()
  test1 <- generatePRNG(100)
  stopifnot(length(test1) == 100)

  # Test 2: Reproducibility
  cleanup_prng()
  createPRNG(list(seed = 42, use_crypto_mixing = FALSE))
  seq1 <- generatePRNG(10)

  cleanup_prng()
  createPRNG(list(seed = 42, use_crypto_mixing = FALSE))
  seq2 <- generatePRNG(10)
  stopifnot(identical(seq1, seq2))

  # Test 3: Distribution generation
  cleanup_prng()
  createPRNG(list(distribution = "exponential", exponential_lambda = 2))
  exp_values <- generatePRNG(1000)
  stopifnot(all(exp_values > 0))

  # Test 4: Thread safety (if using parallel code)
  cleanup_prng()
  createPRNG(list(use_threading = TRUE))
  library(parallel)
  results <- mclapply(1:4, function(x) generatePRNG(100), mc.cores = 4)
  stopifnot(length(unlist(results)) == 400)

  message("All migration tests passed!")
}

test_migration()
```

## Performance Comparison

### Benchmark Script

Compare performance between versions:

```r
benchmark_versions <- function(n = 1e6) {
  # Current version
  createPRNG()
  time_new <- system.time({
    values <- generatePRNG(n)
  })

  cat("Generation time for", n, "values:\n")
  cat("v0.6.0:", time_new["elapsed"], "seconds\n")
  cat("Values per second:", n / time_new["elapsed"], "\n")

  # Memory usage
  cat("\nMemory usage:\n")
  print(object.size(values))
}

benchmark_versions()
```

## Troubleshooting

### Common Issues

#### Issue 1: Thread Safety Warnings

**Symptom**:
```
Warning: PRNG accessed from multiple threads without use_threading=TRUE
```

**Solution**:
```r
# Enable thread-local storage
createPRNG(list(use_threading = TRUE))
```

#### Issue 2: Reproducibility Problems

**Symptom**: Different results with same seed

**Solution**:
```r
# Ensure crypto mixing is disabled
createPRNG(list(
  seed = 12345,
  use_crypto_mixing = FALSE  # Critical for reproducibility
))
```

#### Issue 3: Performance Degradation

**Symptom**: Slower than previous version

**Solution**:
```r
# Enable performance optimizations
createPRNG(list(
  use_parallel_filling = TRUE,
  buffer_size = 4096,  # Larger buffer
  use_threading = TRUE
))
```

## Getting Help

If you encounter issues during migration:

1. Check the [GitHub Issues](https://github.com/biostochastics/qiprng/issues)
2. Review the [comprehensive test suite](https://github.com/biostochastics/qiprng/tree/main/tests)
3. Post in [Discussions](https://github.com/biostochastics/qiprng/discussions)
4. Email support: support@biostochastics.com

## Version Support Timeline

| Version | Status | Support Until | Notes |
|---------|--------|---------------|-------|
| v0.6.x | **Current** | Active | Latest stable |
| v0.5.x | Maintenance | 2025-06-01 | Security fixes only |
| v0.4.x | End of Life | 2024-12-31 | No further updates |
| v0.3.x | Deprecated | - | Upgrade immediately |

<Note>
**Best Practice**: Always test your code with the new version in a development environment before upgrading production systems.
</Note>
